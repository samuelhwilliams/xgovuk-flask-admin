/**
 * Select with Search Component Styles
 *
 * Based on govuk_publishing_components select-with-search component
 * Source: https://github.com/alphagov/govuk_publishing_components/blob/main/app/assets/stylesheets/govuk_publishing_components/components/_select-with-search.scss
 *
 * Uses Choices.js for the enhanced select functionality
 * Choices.js: https://github.com/Choices-js/Choices
 *
 * Changes from original:
 * - Changed from @import to @use "govuk" (Sass module system)
 * - Changed govuk-colour() to govuk.govuk-colour() (namespaced)
 * - Changed all GOV.UK function/mixin calls to use govuk. namespace
 * - Changed $choices-icon-cross from external SVG file to inline data URI
 * - Removed @import "govuk_publishing_components/individual_component_support" (not needed)
 * - Removed @import "mixins/css3" (not needed)
 * - Removed @import "govuk/components/label/label" (included in govuk module)
 * - The component styles themselves are functionally identical to the original
 */
@use "govuk";

// Import Choices.js styles with GOV.UK variable overrides
$font-size: 19px;

$choices-bg-color: govuk.govuk-colour("white") !default;
$choices-font-size-lg: $font-size !default;
$choices-font-size-md: $font-size !default;
$choices-font-size-sm: $font-size !default;
$choices-primary-color: #ffffff !default;
$choices-text-color: govuk.govuk-colour("black");
$choices-icon-cross: url("data:image/svg+xml,%3Csvg width='21' height='21' viewBox='0 0 21 21' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23000' fill-rule='evenodd'%3E%3Cpath d='M2.592.044l18.364 18.364-2.548 2.548L.044 2.592z' /%3E%3Cpath d='M0 18.364L18.364 0l2.548 2.548L2.548 20.912z' /%3E%3C/g%3E%3C/svg%3E");
$choices-border-radius: 0 !default;
$choices-border-radius-item: 0 !default;
$choices-z-index: 2 !default;
$choices-button-dimension: 12px !default;

@import "choices.js/src/styles/choices";

.gem-c-select-with-search {
    .choices * {
        box-sizing: border-box;
        font-family: govuk.$govuk-font-family;
    }

    .choices[data-type="select-one"]
        .choices__list--dropdown
        .choices__list
        .choices__placeholder {
        opacity: 1;
    }

    .choices__placeholder {
        opacity: 0.6;
    }

    .choices[data-type*="select-one"]::after {
        @include govuk.govuk-shape-arrow(
            $direction: down,
            $base: 10px,
            $display: inline-block
        );
        margin: 0;
        transform: translateY(-50%);
    }

    .choices.is-open[data-type*="select-one"]::after {
        margin: 0;
        bottom: govuk.govuk-em(1px, $font-size);
        transform: translateY(-50%) rotate(180deg);
    }

    .choices[data-type*="select-multiple"] .choices__button,
    .choices[data-type*="text"] .choices__button {
        border-color: govuk.govuk-colour("mid-grey");
        border-right: 1px solid govuk.govuk-colour("mid-grey");
        padding: govuk.govuk-spacing(2) govuk.govuk-spacing(4)
            govuk.govuk-spacing(2) govuk.govuk-spacing(2);
        margin-right: 0;

        &:hover {
            background-color: govuk.govuk-colour("mid-grey");
            border-color: govuk.govuk-colour("dark-grey");
            box-shadow: 0 govuk.$govuk-border-width-form-element 0
                govuk.govuk-colour("dark-grey");
        }

        &:focus {
            background-color: govuk.$govuk-focus-colour;
            box-shadow: 0 govuk.$govuk-border-width-form-element 0
                govuk.$govuk-focus-text-colour;
        }
    }

    .choices.is-disabled {
        .choices__item[data-deletable] {
            background-color: govuk.govuk-colour("white");
        }

        .choices__button {
            display: none;
        }
    }

    .choices__input {
        display: block;
        margin-bottom: 0;
    }

    .choices__inner {
        padding: govuk.govuk-spacing(1);
        border: govuk.$govuk-border-width-form-element solid
            govuk.govuk-colour("black");
    }

    &.govuk-form-group--error
        .choices:not(.is-active):not(.is-focused):not(.is-open)
        .choices__inner {
        border-color: govuk.$govuk-error-colour;
    }

    .choices.is-focused,
    .choices.is-open {
        overflow: visible;
    }

    .choices.is-flipped .choices__list {
        border-radius: 0;
        border-width: govuk.$govuk-border-width-form-element;
    }

    .choices.is-focused .choices__inner,
    .choices.is-open .choices__inner {
        outline: govuk.$govuk-focus-width solid govuk.$govuk-focus-colour;
        outline-offset: 0;
        box-shadow: inset 0 0 0 govuk.$govuk-border-width-form-element;
    }

    .choices__list--multiple {
        display: block;

        &:not(:empty) {
            margin-block-start: 6px;
            border-block-start: 1px solid govuk.$govuk-border-colour;
            padding-block-end: 5px;
        }
    }

    .choices__list--multiple .choices__item {
        display: inline-flex;
        align-items: center;
        border: 0;
        padding: 0 0 0 govuk.govuk-spacing(2);
        margin: govuk.govuk-spacing(2) govuk.govuk-spacing(2) 0 0;
        background-color: govuk.govuk-colour("light-grey");
        box-shadow: 0 govuk.$govuk-border-width-form-element 0
            govuk.govuk-colour("mid-grey");
        line-height: 1;
        color: govuk.$govuk-text-colour;

        .is-disabled & {
            opacity: 0.5;
        }
    }

    .choices__list--dropdown,
    .choices__list[aria-expanded] {
        border: govuk.$govuk-border-width-form-element solid
            govuk.govuk-colour("black");
        border-top-width: 0;

        .is-flipped & {
            border-top-width: govuk.$govuk-border-width-form-element;
            border-bottom-width: 0;
        }
    }

    .choices__list--dropdown .choices__item,
    .choices__list[aria-expanded] .choices__item {
        position: relative;
        border-bottom: 1px solid govuk.govuk-colour("mid-grey");

        &:last-child {
            border-bottom: 0;
        }
    }

    .choices__list--dropdown .choices__item--selectable.is-highlighted,
    .choices__list[aria-expanded] .choices__item--selectable.is-highlighted {
        background-color: govuk.govuk-colour("blue");
        border-color: govuk.govuk-colour("blue");
        color: govuk.govuk-colour("white");
        outline: none;
    }

    .choices__heading {
        @include govuk.govuk-typography-weight-bold;
        color: govuk.govuk-colour("black");
        padding: govuk.govuk-spacing(6) govuk.govuk-spacing(2)
            govuk.govuk-spacing(2);
        border-bottom: 1px solid govuk.govuk-colour("mid-grey");
        cursor: default;
    }
}

@media (forced-colors: active) {
    .choices__list--dropdown .choices__item--selectable.is-highlighted,
    .choices__list[aria-expanded] .choices__item--selectable.is-highlighted {
        forced-color-adjust: none;
        background-color: Highlight;
    }
}
